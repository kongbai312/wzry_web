import{a3 as b,t as C,ad as L,r as i,J as ne,W as R,X as oe,w as z,aE as ae,A as N,ai as se,j as K,d as Y,K as F,b as f,aF as X,aA as j,x as M,_ as le,Q as $,D as H,L as G,k as U,y as x,n as ce,a0 as re,l as ie,a6 as ue,af as de,F as fe,aG as ve,m as E}from"./index-M4brf8cj.js";import{u as me}from"./use-expose-DPr-92Zh.js";import{T as _,P as ye,H as he}from"./use-route-BrlykrmF.js";import{I as Ie}from"./_plugin-vue_export-helper-BQC3p5UF.js";import{c as Oe}from"./interceptor-F55hFJrP.js";const V={show:Boolean,zIndex:b,overlay:C,duration:b,teleport:[String,Object],lockScroll:C,lazyRender:C,beforeClose:Function,overlayStyle:Object,overlayClass:L,transitionAppear:Boolean,closeOnClickOverlay:C},Le=Object.keys(V);function Ce(e,t){return e>t?"horizontal":t>e?"vertical":""}function Pe(){const e=i(0),t=i(0),n=i(0),r=i(0),a=i(0),l=i(0),o=i(""),c=i(!0),P=()=>o.value==="vertical",O=()=>o.value==="horizontal",u=()=>{n.value=0,r.value=0,a.value=0,l.value=0,o.value="",c.value=!0};return{move:d=>{const v=d.touches[0];n.value=(v.clientX<0?0:v.clientX)-e.value,r.value=v.clientY-t.value,a.value=Math.abs(n.value),l.value=Math.abs(r.value);const I=10;(!o.value||a.value<I&&l.value<I)&&(o.value=Ce(a.value,l.value)),c.value&&(a.value>_||l.value>_)&&(c.value=!1)},start:d=>{u(),e.value=d.touches[0].clientX,t.value=d.touches[0].clientY},reset:u,startX:e,startY:t,deltaX:n,deltaY:r,offsetX:a,offsetY:l,direction:o,isVertical:P,isHorizontal:O,isTap:c}}let k=0;const D="van-overflow-hidden";function ke(e,t){const n=Pe(),r="01",a="10",l=u=>{n.move(u);const h=n.deltaY.value>0?a:r,w=ae(u.target,e.value),{scrollHeight:d,offsetHeight:v,scrollTop:I}=w;let m="11";I===0?m=v>=d?"00":"01":I+v>=d&&(m="10"),m!=="11"&&n.isVertical()&&!(parseInt(m,2)&parseInt(h,2))&&N(u,!0)},o=()=>{document.addEventListener("touchstart",n.start),document.addEventListener("touchmove",l,{passive:!1}),k||document.body.classList.add(D),k++},c=()=>{k&&(document.removeEventListener("touchstart",n.start),document.removeEventListener("touchmove",l),k--,k||document.body.classList.remove(D))},P=()=>t()&&o(),O=()=>t()&&c();ne(P),R(O),oe(O),z(t,u=>{u?o():c()})}function W(e){const t=i(!1);return z(e,n=>{n&&(t.value=n)},{immediate:!0}),n=>()=>t.value?n():null}const p=()=>{var e;const{scopeId:t}=((e=se())==null?void 0:e.vnode)||{};return t?{[t]:""}:null},[we,Se]=K("overlay"),be={show:Boolean,zIndex:b,duration:b,className:L,lockScroll:C,lazyRender:C,customStyle:Object,teleport:[String,Object]};var Te=Y({name:we,props:be,setup(e,{slots:t}){const n=i(),r=W(()=>e.show||!e.lazyRender),a=o=>{e.lockScroll&&N(o,!0)},l=r(()=>{var o;const c=M(le(e.zIndex),e.customStyle);return $(e.duration)&&(c.animationDuration=`${e.duration}s`),H(f("div",{ref:n,style:c,class:[Se(),e.className]},[(o=t.default)==null?void 0:o.call(t)]),[[G,e.show]])});return F("touchmove",a,{target:n}),()=>{const o=f(X,{name:"van-fade",appear:!0},{default:l});return e.teleport?f(j,{to:e.teleport},{default:()=>[o]}):o}}});const xe=U(Te),ze=M({},V,{round:Boolean,position:x("center"),closeIcon:x("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:x("top-right"),destroyOnClose:Boolean,safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[Ae,B]=K("popup");var ge=Y({name:Ae,inheritAttrs:!1,props:ze,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:t,attrs:n,slots:r}){let a,l;const o=i(),c=i(),P=W(()=>e.show||!e.lazyRender),O=ce(()=>{const s={zIndex:o.value};if($(e.duration)){const y=e.position==="center"?"animationDuration":"transitionDuration";s[y]=`${e.duration}s`}return s}),u=()=>{a||(a=!0,o.value=e.zIndex!==void 0?+e.zIndex:ve(),t("open"))},h=()=>{a&&Oe(e.beforeClose,{done(){a=!1,t("close"),t("update:show",!1)}})},w=s=>{t("clickOverlay",s),e.closeOnClickOverlay&&h()},d=()=>{if(e.overlay)return f(xe,E({show:e.show,class:e.overlayClass,zIndex:o.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0},p(),{onClick:w}),{default:r["overlay-content"]})},v=s=>{t("clickCloseIcon",s),h()},I=()=>{if(e.closeable)return f(Ie,{role:"button",tabindex:0,name:e.closeIcon,class:[B("close-icon",e.closeIconPosition),he],classPrefix:e.iconPrefix,onClick:v},null)};let m;const Z=()=>{m&&clearTimeout(m),m=setTimeout(()=>{t("opened")})},J=()=>t("closed"),Q=s=>t("keydown",s),q=P(()=>{var s;const{destroyOnClose:y,round:T,position:S,safeAreaInsetTop:ee,safeAreaInsetBottom:te,show:g}=e;if(!(!g&&y))return H(f("div",E({ref:c,style:O.value,role:"dialog",tabindex:0,class:[B({round:T,[S]:S}),{"van-safe-area-top":ee,"van-safe-area-bottom":te}],onKeydown:Q},n,p()),[(s=r.default)==null?void 0:s.call(r),I()]),[[G,g]])}),A=()=>{const{position:s,transition:y,transitionAppear:T}=e,S=s==="center"?"van-fade":`van-popup-slide-${s}`;return f(X,{name:y||S,appear:T,onAfterEnter:Z,onAfterLeave:J},{default:q})};return z(()=>e.show,s=>{s&&!a&&(u(),n.tabindex===0&&re(()=>{var y;(y=c.value)==null||y.focus()})),!s&&a&&(a=!1,t("close"))}),me({popupRef:c}),ke(c,()=>e.show&&e.lockScroll),F("popstate",()=>{e.closeOnPopstate&&(h(),l=!1)}),ie(()=>{e.show&&u()}),ue(()=>{l&&(t("update:show",!0),l=!1)}),R(()=>{e.show&&e.teleport&&(h(),l=!0)}),de(ye,()=>e.show),()=>e.teleport?f(j,{to:e.teleport},{default:()=>[d(),A()]}):f(fe,null,[d(),A()])}});const Re=U(ge);export{Re as P,V as a,Pe as b,Le as p,p as u};
