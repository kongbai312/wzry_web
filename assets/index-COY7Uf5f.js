import{a3 as b,t as C,ad as p,r as i,J as ee,W as B,X as te,w as z,aE as oe,A as R,ai as ne,j as N,d as K,K as Y,b as v,aF as F,aA as X,x as j,_ as ae,Q as M,D as $,L as H,k as G,y as x,n as se,a0 as le,l as ce,a6 as re,af as ie,F as ue,aG as de,m as g}from"./index-CACfW1L3.js";import{u as ve}from"./use-expose-BBR89yB_.js";import{T as E,P as fe,H as me}from"./use-route-B3Rl6And.js";import{I as ye}from"./_plugin-vue_export-helper-CZ9DfyQk.js";import{c as he}from"./interceptor-DDwOqtEV.js";const U={show:Boolean,zIndex:b,overlay:C,duration:b,teleport:[String,Object],lockScroll:C,lazyRender:C,beforeClose:Function,overlayStyle:Object,overlayClass:p,transitionAppear:Boolean,closeOnClickOverlay:C},Le=Object.keys(U);function Ie(e,t){return e>t?"horizontal":t>e?"vertical":""}function Oe(){const e=i(0),t=i(0),o=i(0),r=i(0),a=i(0),l=i(0),n=i(""),c=i(!0),P=()=>n.value==="vertical",O=()=>n.value==="horizontal",u=()=>{o.value=0,r.value=0,a.value=0,l.value=0,n.value="",c.value=!0};return{move:d=>{const f=d.touches[0];o.value=(f.clientX<0?0:f.clientX)-e.value,r.value=f.clientY-t.value,a.value=Math.abs(o.value),l.value=Math.abs(r.value);const I=10;(!n.value||a.value<I&&l.value<I)&&(n.value=Ie(a.value,l.value)),c.value&&(a.value>E||l.value>E)&&(c.value=!1)},start:d=>{u(),e.value=d.touches[0].clientX,t.value=d.touches[0].clientY},reset:u,startX:e,startY:t,deltaX:o,deltaY:r,offsetX:a,offsetY:l,direction:n,isVertical:P,isHorizontal:O,isTap:c}}let k=0;const _="van-overflow-hidden";function Ce(e,t){const o=Oe(),r="01",a="10",l=u=>{o.move(u);const h=o.deltaY.value>0?a:r,w=oe(u.target,e.value),{scrollHeight:d,offsetHeight:f,scrollTop:I}=w;let m="11";I===0?m=f>=d?"00":"01":I+f>=d&&(m="10"),m!=="11"&&o.isVertical()&&!(parseInt(m,2)&parseInt(h,2))&&R(u,!0)},n=()=>{document.addEventListener("touchstart",o.start),document.addEventListener("touchmove",l,{passive:!1}),k||document.body.classList.add(_),k++},c=()=>{k&&(document.removeEventListener("touchstart",o.start),document.removeEventListener("touchmove",l),k--,k||document.body.classList.remove(_))},P=()=>t()&&n(),O=()=>t()&&c();ee(P),B(O),te(O),z(t,u=>{u?n():c()})}function V(e){const t=i(!1);return z(e,o=>{o&&(t.value=o)},{immediate:!0}),o=>()=>t.value?o():null}const D=()=>{var e;const{scopeId:t}=((e=ne())==null?void 0:e.vnode)||{};return t?{[t]:""}:null},[Pe,ke]=N("overlay"),we={show:Boolean,zIndex:b,duration:b,className:p,lockScroll:C,lazyRender:C,customStyle:Object,teleport:[String,Object]};var Se=K({name:Pe,props:we,setup(e,{slots:t}){const o=i(),r=V(()=>e.show||!e.lazyRender),a=n=>{e.lockScroll&&R(n,!0)},l=r(()=>{var n;const c=j(ae(e.zIndex),e.customStyle);return M(e.duration)&&(c.animationDuration=`${e.duration}s`),$(v("div",{ref:o,style:c,class:[ke(),e.className]},[(n=t.default)==null?void 0:n.call(t)]),[[H,e.show]])});return Y("touchmove",a,{target:o}),()=>{const n=v(F,{name:"van-fade",appear:!0},{default:l});return e.teleport?v(X,{to:e.teleport},{default:()=>[n]}):n}}});const be=G(Se),Te=j({},U,{round:Boolean,position:x("center"),closeIcon:x("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:x("top-right"),safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[xe,L]=N("popup");var ze=K({name:xe,inheritAttrs:!1,props:Te,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:t,attrs:o,slots:r}){let a,l;const n=i(),c=i(),P=V(()=>e.show||!e.lazyRender),O=se(()=>{const s={zIndex:n.value};if(M(e.duration)){const y=e.position==="center"?"animationDuration":"transitionDuration";s[y]=`${e.duration}s`}return s}),u=()=>{a||(a=!0,n.value=e.zIndex!==void 0?+e.zIndex:de(),t("open"))},h=()=>{a&&he(e.beforeClose,{done(){a=!1,t("close"),t("update:show",!1)}})},w=s=>{t("clickOverlay",s),e.closeOnClickOverlay&&h()},d=()=>{if(e.overlay)return v(be,g({show:e.show,class:e.overlayClass,zIndex:n.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0},D(),{onClick:w}),{default:r["overlay-content"]})},f=s=>{t("clickCloseIcon",s),h()},I=()=>{if(e.closeable)return v(ye,{role:"button",tabindex:0,name:e.closeIcon,class:[L("close-icon",e.closeIconPosition),me],classPrefix:e.iconPrefix,onClick:f},null)};let m;const W=()=>{m&&clearTimeout(m),m=setTimeout(()=>{t("opened")})},Z=()=>t("closed"),J=s=>t("keydown",s),Q=P(()=>{var s;const{round:y,position:S,safeAreaInsetTop:T,safeAreaInsetBottom:q}=e;return $(v("div",g({ref:c,style:O.value,role:"dialog",tabindex:0,class:[L({round:y,[S]:S}),{"van-safe-area-top":T,"van-safe-area-bottom":q}],onKeydown:J},o,D()),[(s=r.default)==null?void 0:s.call(r),I()]),[[H,e.show]])}),A=()=>{const{position:s,transition:y,transitionAppear:S}=e,T=s==="center"?"van-fade":`van-popup-slide-${s}`;return v(F,{name:y||T,appear:S,onAfterEnter:W,onAfterLeave:Z},{default:Q})};return z(()=>e.show,s=>{s&&!a&&(u(),o.tabindex===0&&le(()=>{var y;(y=c.value)==null||y.focus()})),!s&&a&&(a=!1,t("close"))}),ve({popupRef:c}),Ce(c,()=>e.show&&e.lockScroll),Y("popstate",()=>{e.closeOnPopstate&&(h(),l=!1)}),ce(()=>{e.show&&u()}),re(()=>{l&&(t("update:show",!0),l=!1)}),B(()=>{e.show&&e.teleport&&(h(),l=!0)}),ie(fe,()=>e.show),()=>e.teleport?v(X,{to:e.teleport},{default:()=>[d(),A()]}):v(ue,null,[d(),A()])}});const pe=G(ze);export{pe as P,U as a,Oe as b,Le as p,D as u};
